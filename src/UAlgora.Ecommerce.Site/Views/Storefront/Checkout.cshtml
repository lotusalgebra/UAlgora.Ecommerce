@model CheckoutViewModel

<div class="min-h-screen bg-gray-50 dark:bg-fashion-charcoal" x-data="checkoutPage()">
    <!-- Minimal Header -->
    <header class="bg-white dark:bg-fashion-black border-b border-gray-200 dark:border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <a href="/" class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-accent-500 rounded-full flex items-center justify-center">
                        <span class="text-white font-display text-lg font-bold">A</span>
                    </div>
                    <span class="font-display text-xl font-bold text-fashion-black dark:text-white">ALGORA</span>
                </a>

                <!-- Secure Checkout Badge -->
                <div class="hidden sm:flex items-center gap-2 text-gray-500 dark:text-gray-400">
                    <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-sm font-medium">Secure Checkout</span>
                </div>

                <!-- Back to Cart -->
                <a href="/cart" class="text-fashion-black dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition flex items-center gap-2 text-sm font-medium">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    <span class="hidden sm:inline">Back to Cart</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Progress Stepper -->
    <div class="bg-white dark:bg-fashion-black border-b border-gray-200 dark:border-gray-800">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center justify-between">
                <template x-for="(stepData, index) in [
                    { name: 'Information', icon: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z' },
                    { name: 'Shipping', icon: 'M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4' },
                    { name: 'Payment', icon: 'M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z' },
                    { name: 'Review', icon: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' }
                ]" :key="index">
                    <div class="flex items-center flex-1" :class="index < 3 ? 'flex-1' : ''">
                        <!-- Step Circle -->
                        <div class="flex flex-col items-center">
                            <div class="relative">
                                <div :class="{
                                    'bg-fashion-black dark:bg-white text-white dark:text-fashion-black': step > index,
                                    'bg-primary-500 text-white ring-4 ring-primary-100 dark:ring-primary-900': step === index,
                                    'bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400': step < index
                                }" class="w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300">
                                    <template x-if="step > index">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                        </svg>
                                    </template>
                                    <template x-if="step <= index">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" :d="stepData.icon"/>
                                        </svg>
                                    </template>
                                </div>
                            </div>
                            <span :class="step >= index ? 'text-fashion-black dark:text-white font-medium' : 'text-gray-400 dark:text-gray-500'"
                                  class="mt-2 text-xs uppercase tracking-wider hidden sm:block" x-text="stepData.name"></span>
                        </div>
                        <!-- Connector Line -->
                        <template x-if="index < 3">
                            <div class="flex-1 mx-4">
                                <div class="h-0.5 bg-gray-200 dark:bg-gray-700 relative">
                                    <div :class="step > index ? 'w-full' : 'w-0'"
                                         class="absolute inset-0 bg-fashion-black dark:bg-white transition-all duration-500"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
        <div class="grid lg:grid-cols-12 gap-8 lg:gap-12">
            <!-- Main Content -->
            <div class="lg:col-span-7">
                <!-- Express Checkout (Step 0 only) -->
                <div x-show="step === 0" class="mb-8">
                    <div class="bg-white dark:bg-fashion-black border border-gray-200 dark:border-gray-800 p-6">
                        <p class="text-center text-sm text-gray-500 dark:text-gray-400 mb-4 uppercase tracking-wider">Express Checkout</p>
                        <div class="grid grid-cols-3 gap-3">
                            <!-- Apple Pay -->
                            <button class="bg-black text-white py-3.5 flex items-center justify-center gap-2 hover:bg-gray-800 transition">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                                </svg>
                                <span class="font-medium text-sm">Pay</span>
                            </button>
                            <!-- Google Pay -->
                            <button class="bg-white border border-gray-300 py-3.5 flex items-center justify-center gap-2 hover:bg-gray-50 transition">
                                <svg class="w-5 h-5" viewBox="0 0 24 24">
                                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                </svg>
                                <span class="font-medium text-sm text-gray-700">Pay</span>
                            </button>
                            <!-- PayPal Express -->
                            <button class="bg-[#FFC439] py-3.5 flex items-center justify-center gap-2 hover:bg-[#f0b429] transition">
                                <svg class="h-5" viewBox="0 0 101 32" fill="none">
                                    <path fill="#003087" d="M12.237 4.1H5.767c-.44 0-.815.319-.883.751L2.138 22.28c-.052.327.202.622.537.622h3.1c.44 0 .816-.319.884-.751l.738-4.676c.068-.432.444-.751.884-.751h2.037c4.247 0 6.698-2.056 7.34-6.133.289-1.784.012-3.187-.824-4.17-.919-1.079-2.548-1.621-4.598-1.621"/>
                                    <path fill="#003087" d="M13.233 10.471c-.352 2.313-2.12 2.313-3.832 2.313h-.973l.683-4.325c.041-.259.263-.449.527-.449h.446c1.165 0 2.265 0 2.833.664.34.397.443.986.316 1.797"/>
                                    <path fill="#003087" d="M35.05 10.369h-3.112c-.264 0-.486.19-.527.449l-.137.868-.217-.315c-.673-.977-2.174-1.304-3.672-1.304-3.435 0-6.37 2.602-6.94 6.255-.296 1.823.125 3.566 1.152 4.779.944 1.113 2.293 1.577 3.898 1.577 2.756 0 4.284-1.771 4.284-1.771l-.139.859c-.052.327.201.622.537.622h2.801c.44 0 .815-.319.884-.751l1.682-10.646c.052-.327-.201-.622-.537-.622"/>
                                    <path fill="#003087" d="M30.168 16.417c-.299 1.765-1.701 2.95-3.49 2.95-.898 0-1.617-.289-2.078-.836-.458-.543-.631-1.316-.487-2.178.28-1.75 1.703-2.976 3.463-2.976.879 0 1.593.292 2.066.845.476.558.664 1.337.526 2.195"/>
                                    <path fill="#0070BA" d="M55.92 10.369h-3.127c-.297 0-.575.144-.746.388l-4.308 6.343-1.825-6.097c-.114-.379-.46-.634-.857-.634h-3.074c-.371 0-.632.361-.513.713l3.44 10.098-3.237 4.566c-.254.358.009.852.446.852h3.124c.294 0 .57-.142.741-.381l10.39-15.003c.249-.36-.015-.845-.454-.845"/>
                                    <path fill="#0070BA" d="M67.82 4.1h-6.47c-.44 0-.815.319-.883.751l-2.745 17.429c-.052.327.201.622.537.622h3.286c.307 0 .57-.223.618-.527l.779-4.94c.068-.432.443-.751.884-.751h2.036c4.248 0 6.699-2.056 7.34-6.133.29-1.784.012-3.187-.823-4.17-.919-1.079-2.548-1.621-4.599-1.621"/>
                                    <path fill="#0070BA" d="M68.816 10.471c-.352 2.313-2.12 2.313-3.832 2.313h-.973l.683-4.325c.041-.259.264-.449.527-.449h.446c1.165 0 2.266 0 2.833.664.34.397.443.986.316 1.797"/>
                                    <path fill="#0070BA" d="M90.634 10.369h-3.112c-.264 0-.486.19-.527.449l-.137.868-.218-.315c-.672-.977-2.173-1.304-3.671-1.304-3.435 0-6.37 2.602-6.94 6.255-.296 1.823.124 3.566 1.152 4.779.943 1.113 2.292 1.577 3.898 1.577 2.755 0 4.283-1.771 4.283-1.771l-.138.859c-.052.327.201.622.536.622h2.802c.44 0 .815-.319.883-.751l1.683-10.646c.051-.327-.202-.622-.538-.622"/>
                                    <path fill="#0070BA" d="M85.752 16.417c-.299 1.765-1.701 2.95-3.49 2.95-.898 0-1.617-.289-2.078-.836-.458-.543-.631-1.316-.487-2.178.28-1.75 1.703-2.976 3.463-2.976.88 0 1.594.292 2.066.845.476.558.665 1.337.526 2.195"/>
                                    <path fill="#0070BA" d="M94.093 4.527l-2.788 17.742c-.051.327.202.622.537.622h2.68c.44 0 .815-.319.883-.751l2.746-17.429c.051-.327-.202-.622-.537-.622h-2.984c-.264 0-.486.19-.527.449"/>
                                </svg>
                            </button>
                        </div>
                        <div class="flex items-center gap-4 mt-6">
                            <div class="flex-1 h-px bg-gray-200 dark:bg-gray-700"></div>
                            <span class="text-xs text-gray-400 uppercase tracking-wider">Or continue below</span>
                            <div class="flex-1 h-px bg-gray-200 dark:bg-gray-700"></div>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Information -->
                <div x-show="step === 0" class="bg-white dark:bg-fashion-black border border-gray-200 dark:border-gray-800">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-800">
                        <h2 class="font-display text-2xl font-bold text-fashion-black dark:text-white">Contact Information</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">We'll use this email to send you order updates</p>
                    </div>

                    <div class="p-6 space-y-5">
                        <!-- Email with Floating Label -->
                        <div class="relative">
                            <input type="email" id="email" x-model="info.email" required
                                   class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                   placeholder="Email">
                            <label for="email" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                Email Address *
                            </label>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <!-- First Name -->
                            <div class="relative">
                                <input type="text" id="firstName" x-model="info.firstName" required
                                       class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                       placeholder="First Name">
                                <label for="firstName" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                    First Name *
                                </label>
                            </div>
                            <!-- Last Name -->
                            <div class="relative">
                                <input type="text" id="lastName" x-model="info.lastName" required
                                       class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                       placeholder="Last Name">
                                <label for="lastName" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                    Last Name *
                                </label>
                            </div>
                        </div>

                        <!-- Phone -->
                        <div class="relative">
                            <input type="tel" id="phone" x-model="info.phone"
                                   class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                   placeholder="Phone">
                            <label for="phone" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                Phone Number (for delivery updates)
                            </label>
                        </div>
                    </div>

                    <div class="p-6 border-t border-gray-200 dark:border-gray-800">
                        <h2 class="font-display text-2xl font-bold text-fashion-black dark:text-white mb-6">Shipping Address</h2>

                        <div class="space-y-5">
                            <!-- Address -->
                            <div class="relative">
                                <input type="text" id="address1" x-model="shipping.address1" required
                                       class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                       placeholder="Address">
                                <label for="address1" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                    Street Address *
                                </label>
                            </div>

                            <!-- Apartment -->
                            <div class="relative">
                                <input type="text" id="address2" x-model="shipping.address2"
                                       class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                       placeholder="Apartment">
                                <label for="address2" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                    Apartment, suite, etc. (optional)
                                </label>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <!-- City -->
                                <div class="relative">
                                    <input type="text" id="city" x-model="shipping.city" required
                                           class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                           placeholder="City">
                                    <label for="city" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                        City *
                                    </label>
                                </div>
                                <!-- State -->
                                <div class="relative">
                                    <select id="state" x-model="shipping.state" required
                                            class="w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition appearance-none">
                                        <option value="">Select state</option>
                                        <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option>
                                        <option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option>
                                        <option value="FL">Florida</option><option value="GA">Georgia</option><option value="IL">Illinois</option>
                                        <option value="NY">New York</option><option value="TX">Texas</option><option value="WA">Washington</option>
                                    </select>
                                    <label class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400">State *</label>
                                    <svg class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <!-- ZIP -->
                                <div class="relative">
                                    <input type="text" id="postalCode" x-model="shipping.postalCode" required
                                           class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                           placeholder="ZIP Code">
                                    <label for="postalCode" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                        ZIP Code *
                                    </label>
                                </div>
                                <!-- Country -->
                                <div class="relative">
                                    <select id="country" x-model="shipping.country" required
                                            class="w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition appearance-none">
                                        <option value="US">United States</option>
                                        <option value="CA">Canada</option>
                                        <option value="UK">United Kingdom</option>
                                        <option value="AU">Australia</option>
                                    </select>
                                    <label class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400">Country *</label>
                                    <svg class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </div>
                            </div>

                            <!-- Save Address Checkbox -->
                            <label class="flex items-center gap-3 cursor-pointer group">
                                <input type="checkbox" x-model="saveAddress" class="w-5 h-5 rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                                <span class="text-sm text-gray-600 dark:text-gray-400 group-hover:text-fashion-black dark:group-hover:text-white transition">Save this address for future orders</span>
                            </label>
                        </div>
                    </div>

                    <div class="p-6 border-t border-gray-100 dark:border-gray-800">
                        <button @@click="nextStep()" class="w-full bg-fashion-black dark:bg-white text-white dark:text-fashion-black py-4 text-sm uppercase tracking-widest font-medium hover:bg-primary-600 dark:hover:bg-primary-400 hover:text-white transition-colors">
                            Continue to Shipping
                        </button>
                    </div>
                </div>

                <!-- Step 2: Shipping Method -->
                <div x-show="step === 1" x-cloak class="bg-white dark:bg-fashion-black border border-gray-200 dark:border-gray-800">
                    <!-- Shipping Info Summary -->
                    <div class="p-6 bg-gray-50 dark:bg-fashion-charcoal border-b border-gray-200 dark:border-gray-800">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1">Ship to</p>
                                <p class="text-fashion-black dark:text-white font-medium" x-text="`${info.firstName} ${info.lastName}`"></p>
                                <p class="text-sm text-gray-600 dark:text-gray-400" x-text="shipping.address1"></p>
                                <p class="text-sm text-gray-600 dark:text-gray-400" x-text="`${shipping.city}, ${shipping.state} ${shipping.postalCode}`"></p>
                            </div>
                            <button @@click="step = 0" class="text-primary-600 dark:text-primary-400 text-sm font-medium hover:underline">Change</button>
                        </div>
                    </div>

                    <div class="p-6">
                        <h2 class="font-display text-2xl font-bold text-fashion-black dark:text-white mb-6">Choose Shipping Method</h2>

                        <div class="space-y-3">
                            @foreach (var method in Model.ShippingMethods)
                            {
                                <label class="block p-4 border-2 cursor-pointer transition-all"
                                       :class="selectedShipping === '@method.Id'
                                           ? 'border-fashion-black dark:border-white bg-gray-50 dark:bg-fashion-charcoal'
                                           : 'border-gray-200 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-500'">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-4">
                                            <div class="w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all"
                                                 :class="selectedShipping === '@method.Id'
                                                     ? 'border-fashion-black dark:border-white'
                                                     : 'border-gray-300 dark:border-gray-600'">
                                                <div class="w-2.5 h-2.5 rounded-full bg-fashion-black dark:bg-white transition-opacity"
                                                     :class="selectedShipping === '@method.Id' ? 'opacity-100' : 'opacity-0'"></div>
                                            </div>
                                            <input type="radio" name="shipping" value="@method.Id" x-model="selectedShipping" class="sr-only">
                                            <div>
                                                <p class="font-medium text-fashion-black dark:text-white">@method.Name</p>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">@method.EstimatedDelivery</p>
                                            </div>
                                        </div>
                                        <span class="font-display text-lg font-bold text-fashion-black dark:text-white">
                                            @(method.Price == 0 ? "FREE" : $"${method.Price:F2}")
                                        </span>
                                    </div>
                                </label>
                            }
                        </div>

                        <!-- Delivery Note -->
                        <div class="mt-6 p-4 bg-primary-50 dark:bg-primary-900/20 border border-primary-200 dark:border-primary-800">
                            <div class="flex gap-3">
                                <svg class="w-5 h-5 text-primary-600 dark:text-primary-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <p class="text-sm text-primary-800 dark:text-primary-200">
                                    Delivery times are estimated. You'll receive tracking info once your order ships.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 border-t border-gray-100 dark:border-gray-800 flex justify-between items-center">
                        <button @@click="prevStep()" class="text-fashion-black dark:text-white hover:text-primary-600 dark:hover:text-primary-400 font-medium flex items-center gap-2 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                            </svg>
                            Back
                        </button>
                        <button @@click="nextStep()" class="bg-fashion-black dark:bg-white text-white dark:text-fashion-black px-8 py-4 text-sm uppercase tracking-widest font-medium hover:bg-primary-600 dark:hover:bg-primary-400 hover:text-white transition-colors">
                            Continue to Payment
                        </button>
                    </div>
                </div>

                <!-- Step 3: Payment -->
                <div x-show="step === 2" x-cloak class="bg-white dark:bg-fashion-black border border-gray-200 dark:border-gray-800">
                    <!-- Info Summary -->
                    <div class="p-6 bg-gray-50 dark:bg-fashion-charcoal border-b border-gray-200 dark:border-gray-800 space-y-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1">Contact</p>
                                <p class="text-fashion-black dark:text-white" x-text="info.email"></p>
                            </div>
                            <button @@click="step = 0" class="text-primary-600 dark:text-primary-400 text-sm font-medium hover:underline">Change</button>
                        </div>
                        <div class="h-px bg-gray-200 dark:bg-gray-700"></div>
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1">Ship to</p>
                                <p class="text-fashion-black dark:text-white" x-text="`${shipping.address1}, ${shipping.city}, ${shipping.state}`"></p>
                            </div>
                            <button @@click="step = 0" class="text-primary-600 dark:text-primary-400 text-sm font-medium hover:underline">Change</button>
                        </div>
                        <div class="h-px bg-gray-200 dark:bg-gray-700"></div>
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1">Shipping</p>
                                <p class="text-fashion-black dark:text-white" x-text="getShippingName()"></p>
                            </div>
                            <button @@click="step = 1" class="text-primary-600 dark:text-primary-400 text-sm font-medium hover:underline">Change</button>
                        </div>
                    </div>

                    <div class="p-6">
                        <h2 class="font-display text-2xl font-bold text-fashion-black dark:text-white mb-6">Payment Method</h2>

                        <!-- Payment Options -->
                        <div class="space-y-3 mb-6">
                            <label class="block p-4 border-2 cursor-pointer transition-all"
                                   :class="paymentMethod === 'card'
                                       ? 'border-fashion-black dark:border-white bg-gray-50 dark:bg-fashion-charcoal'
                                       : 'border-gray-200 dark:border-gray-700 hover:border-gray-400'">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <div class="w-5 h-5 rounded-full border-2 flex items-center justify-center"
                                             :class="paymentMethod === 'card' ? 'border-fashion-black dark:border-white' : 'border-gray-300 dark:border-gray-600'">
                                            <div class="w-2.5 h-2.5 rounded-full bg-fashion-black dark:bg-white" x-show="paymentMethod === 'card'"></div>
                                        </div>
                                        <input type="radio" name="payment" value="card" x-model="paymentMethod" class="sr-only">
                                        <span class="font-medium text-fashion-black dark:text-white">Credit / Debit Card</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <div class="w-10 h-6 bg-gradient-to-br from-blue-600 to-blue-800 rounded flex items-center justify-center">
                                            <span class="text-white text-[8px] font-bold italic">VISA</span>
                                        </div>
                                        <div class="w-10 h-6 bg-gradient-to-br from-red-500 to-orange-500 rounded flex items-center justify-center">
                                            <div class="flex -space-x-1">
                                                <div class="w-3 h-3 rounded-full bg-red-600 opacity-80"></div>
                                                <div class="w-3 h-3 rounded-full bg-yellow-400 opacity-80"></div>
                                            </div>
                                        </div>
                                        <div class="w-10 h-6 bg-blue-900 rounded flex items-center justify-center">
                                            <span class="text-white text-[6px] font-bold">AMEX</span>
                                        </div>
                                    </div>
                                </div>
                            </label>

                            <label class="block p-4 border-2 cursor-pointer transition-all"
                                   :class="paymentMethod === 'paypal'
                                       ? 'border-fashion-black dark:border-white bg-gray-50 dark:bg-fashion-charcoal'
                                       : 'border-gray-200 dark:border-gray-700 hover:border-gray-400'">
                                <div class="flex items-center gap-4">
                                    <div class="w-5 h-5 rounded-full border-2 flex items-center justify-center"
                                         :class="paymentMethod === 'paypal' ? 'border-fashion-black dark:border-white' : 'border-gray-300 dark:border-gray-600'">
                                        <div class="w-2.5 h-2.5 rounded-full bg-fashion-black dark:bg-white" x-show="paymentMethod === 'paypal'"></div>
                                    </div>
                                    <input type="radio" name="payment" value="paypal" x-model="paymentMethod" class="sr-only">
                                    <span class="font-medium text-fashion-black dark:text-white">PayPal</span>
                                    <span class="ml-auto text-[#003087] font-bold text-sm italic">Pay<span class="text-[#0070BA]">Pal</span></span>
                                </div>
                            </label>
                        </div>

                        <!-- Card Form -->
                        <div x-show="paymentMethod === 'card'" x-collapse class="space-y-5 pt-4 border-t border-gray-200 dark:border-gray-700">
                            <!-- Card Number -->
                            <div class="relative">
                                <input type="text" id="cardNumber" x-model="card.number" maxlength="19"
                                       @@input="formatCardNumber($event)"
                                       class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                       placeholder="Card Number">
                                <label for="cardNumber" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                    Card Number *
                                </label>
                                <div class="absolute right-4 top-1/2 -translate-y-1/2">
                                    <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                                    </svg>
                                </div>
                            </div>

                            <!-- Name on Card -->
                            <div class="relative">
                                <input type="text" id="cardName" x-model="card.name"
                                       class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent uppercase"
                                       placeholder="Name on Card">
                                <label for="cardName" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                    Name on Card *
                                </label>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <!-- Expiry -->
                                <div class="relative">
                                    <input type="text" id="expiry" x-model="card.expiry" maxlength="5"
                                           @@input="formatExpiry($event)"
                                           class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                           placeholder="MM/YY">
                                    <label for="expiry" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                        Expiry Date *
                                    </label>
                                </div>
                                <!-- CVV -->
                                <div class="relative">
                                    <input type="password" id="cvv" x-model="card.cvv" maxlength="4"
                                           class="peer w-full px-4 pt-6 pb-2 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition placeholder-transparent"
                                           placeholder="CVV">
                                    <label for="cvv" class="absolute left-4 top-2 text-xs text-gray-500 dark:text-gray-400 transition-all peer-placeholder-shown:top-4 peer-placeholder-shown:text-base peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600">
                                        Security Code (CVV) *
                                    </label>
                                    <button type="button" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Billing Address -->
                            <label class="flex items-center gap-3 cursor-pointer group pt-2">
                                <input type="checkbox" x-model="sameAsShipping" class="w-5 h-5 rounded border-gray-300 text-fashion-black focus:ring-fashion-black">
                                <span class="text-sm text-gray-600 dark:text-gray-400 group-hover:text-fashion-black dark:group-hover:text-white transition">Billing address same as shipping</span>
                            </label>
                        </div>

                        <!-- Security Notice -->
                        <div class="mt-6 flex items-center gap-3 text-gray-500 dark:text-gray-400">
                            <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <span class="text-sm">Your payment is secured with 256-bit SSL encryption</span>
                        </div>
                    </div>

                    <div class="p-6 border-t border-gray-100 dark:border-gray-800 flex justify-between items-center">
                        <button @@click="prevStep()" class="text-fashion-black dark:text-white hover:text-primary-600 dark:hover:text-primary-400 font-medium flex items-center gap-2 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                            </svg>
                            Back
                        </button>
                        <button @@click="nextStep()" class="bg-fashion-black dark:bg-white text-white dark:text-fashion-black px-8 py-4 text-sm uppercase tracking-widest font-medium hover:bg-primary-600 dark:hover:bg-primary-400 hover:text-white transition-colors">
                            Review Order
                        </button>
                    </div>
                </div>

                <!-- Step 4: Review -->
                <div x-show="step === 3" x-cloak class="bg-white dark:bg-fashion-black border border-gray-200 dark:border-gray-800">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-800">
                        <h2 class="font-display text-2xl font-bold text-fashion-black dark:text-white">Review Your Order</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Please confirm all details before placing your order</p>
                    </div>

                    <!-- Review Cards -->
                    <div class="p-6 grid md:grid-cols-2 gap-4">
                        <!-- Contact -->
                        <div class="p-4 bg-gray-50 dark:bg-fashion-charcoal border border-gray-200 dark:border-gray-700">
                            <div class="flex justify-between items-start mb-2">
                                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider">Contact</p>
                                <button @@click="step = 0" class="text-primary-600 dark:text-primary-400 text-xs font-medium hover:underline">Edit</button>
                            </div>
                            <p class="text-fashion-black dark:text-white font-medium" x-text="info.email"></p>
                            <p class="text-sm text-gray-600 dark:text-gray-400" x-text="info.phone || 'No phone provided'"></p>
                        </div>

                        <!-- Shipping Address -->
                        <div class="p-4 bg-gray-50 dark:bg-fashion-charcoal border border-gray-200 dark:border-gray-700">
                            <div class="flex justify-between items-start mb-2">
                                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ship to</p>
                                <button @@click="step = 0" class="text-primary-600 dark:text-primary-400 text-xs font-medium hover:underline">Edit</button>
                            </div>
                            <p class="text-fashion-black dark:text-white font-medium" x-text="`${info.firstName} ${info.lastName}`"></p>
                            <p class="text-sm text-gray-600 dark:text-gray-400" x-text="shipping.address1"></p>
                            <p class="text-sm text-gray-600 dark:text-gray-400" x-text="`${shipping.city}, ${shipping.state} ${shipping.postalCode}`"></p>
                        </div>

                        <!-- Shipping Method -->
                        <div class="p-4 bg-gray-50 dark:bg-fashion-charcoal border border-gray-200 dark:border-gray-700">
                            <div class="flex justify-between items-start mb-2">
                                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider">Shipping Method</p>
                                <button @@click="step = 1" class="text-primary-600 dark:text-primary-400 text-xs font-medium hover:underline">Edit</button>
                            </div>
                            <p class="text-fashion-black dark:text-white font-medium" x-text="getShippingName()"></p>
                            <p class="text-sm text-gray-600 dark:text-gray-400" x-text="getShippingEstimate()"></p>
                        </div>

                        <!-- Payment -->
                        <div class="p-4 bg-gray-50 dark:bg-fashion-charcoal border border-gray-200 dark:border-gray-700">
                            <div class="flex justify-between items-start mb-2">
                                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider">Payment</p>
                                <button @@click="step = 2" class="text-primary-600 dark:text-primary-400 text-xs font-medium hover:underline">Edit</button>
                            </div>
                            <template x-if="paymentMethod === 'card'">
                                <div>
                                    <p class="text-fashion-black dark:text-white font-medium">Credit Card</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400" x-text="'•••• •••• •••• ' + card.number.slice(-4)"></p>
                                </div>
                            </template>
                            <template x-if="paymentMethod === 'paypal'">
                                <p class="text-fashion-black dark:text-white font-medium">PayPal</p>
                            </template>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="p-6 border-t border-gray-200 dark:border-gray-800">
                        <h3 class="text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-4">Order Items (<span x-text="cart.items.length"></span>)</h3>
                        <div class="space-y-4">
                            <template x-for="item in cart.items" :key="item.id">
                                <div class="flex gap-4">
                                    <div class="w-20 h-24 bg-gray-100 dark:bg-fashion-charcoal flex-shrink-0 overflow-hidden">
                                        <img :src="item.image || 'https://placehold.co/80x96/e2e8f0/64748b?text=Product'" :alt="item.name" class="w-full h-full object-cover">
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium text-fashion-black dark:text-white truncate" x-text="item.name"></h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400" x-text="`Size: ${item.size || 'One Size'}`"></p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400" x-text="`Qty: ${item.quantity}`"></p>
                                    </div>
                                    <p class="font-display text-lg font-bold text-fashion-black dark:text-white" x-text="'$' + (item.price * item.quantity).toFixed(2)"></p>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Terms -->
                    <div class="p-6 border-t border-gray-200 dark:border-gray-800">
                        <label class="flex items-start gap-3 cursor-pointer group">
                            <input type="checkbox" x-model="acceptTerms" class="w-5 h-5 mt-0.5 rounded border-gray-300 text-fashion-black focus:ring-fashion-black">
                            <span class="text-sm text-gray-600 dark:text-gray-400">
                                I agree to the <a href="/terms" class="text-primary-600 dark:text-primary-400 hover:underline">Terms & Conditions</a> and <a href="/privacy" class="text-primary-600 dark:text-primary-400 hover:underline">Privacy Policy</a>
                            </span>
                        </label>
                    </div>

                    <div class="p-6 border-t border-gray-100 dark:border-gray-800 flex justify-between items-center">
                        <button @@click="prevStep()" class="text-fashion-black dark:text-white hover:text-primary-600 dark:hover:text-primary-400 font-medium flex items-center gap-2 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                            </svg>
                            Back
                        </button>
                        <button @@click="placeOrder()"
                                :disabled="processing || !acceptTerms"
                                class="bg-accent-500 text-white px-8 py-4 text-sm uppercase tracking-widest font-medium hover:bg-accent-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2">
                            <template x-if="processing">
                                <svg class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </template>
                            <template x-if="!processing">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                </svg>
                            </template>
                            <span x-text="processing ? 'Processing...' : `Pay $${orderTotal.toFixed(2)}`"></span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Order Summary Sidebar -->
            <div class="lg:col-span-5">
                <div class="bg-white dark:bg-fashion-black border border-gray-200 dark:border-gray-800 sticky top-8">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-800">
                        <h2 class="font-display text-xl font-bold text-fashion-black dark:text-white">Order Summary</h2>
                    </div>

                    <!-- Cart Items -->
                    <div class="p-6 max-h-80 overflow-y-auto border-b border-gray-200 dark:border-gray-800">
                        <div class="space-y-4">
                            <template x-for="item in cart.items" :key="item.id">
                                <div class="flex gap-4">
                                    <div class="relative flex-shrink-0">
                                        <div class="w-16 h-20 bg-gray-100 dark:bg-fashion-charcoal overflow-hidden">
                                            <img :src="item.image || 'https://placehold.co/64x80/e2e8f0/64748b?text=P'" :alt="item.name" class="w-full h-full object-cover">
                                        </div>
                                        <span class="absolute -top-2 -right-2 bg-gray-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-medium" x-text="item.quantity"></span>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-medium text-fashion-black dark:text-white truncate" x-text="item.name"></p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400" x-text="`Size: ${item.size || 'One Size'}`"></p>
                                    </div>
                                    <p class="text-sm font-medium text-fashion-black dark:text-white" x-text="'$' + (item.price * item.quantity).toFixed(2)"></p>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Promo Code -->
                    <div class="p-6 border-b border-gray-200 dark:border-gray-800">
                        <div class="flex gap-2">
                            <input type="text" x-model="promoCode" placeholder="Promo code"
                                   class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-700 bg-transparent text-fashion-black dark:text-white text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                            <button @@click="applyPromo()" class="px-6 py-3 border border-fashion-black dark:border-white text-fashion-black dark:text-white text-sm uppercase tracking-wider font-medium hover:bg-fashion-black hover:text-white dark:hover:bg-white dark:hover:text-fashion-black transition">
                                Apply
                            </button>
                        </div>
                        <template x-if="promoApplied">
                            <div class="mt-2 flex items-center gap-2 text-green-600 dark:text-green-400">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <span class="text-sm" x-text="promoMessage"></span>
                            </div>
                        </template>
                    </div>

                    <!-- Totals -->
                    <div class="p-6 space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600 dark:text-gray-400">Subtotal</span>
                            <span class="text-fashion-black dark:text-white" x-text="'$' + cart.subtotal.toFixed(2)"></span>
                        </div>
                        <template x-if="promoDiscount > 0">
                            <div class="flex justify-between text-sm text-green-600 dark:text-green-400">
                                <span>Discount</span>
                                <span x-text="'-$' + promoDiscount.toFixed(2)"></span>
                            </div>
                        </template>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600 dark:text-gray-400">Shipping</span>
                            <span class="text-fashion-black dark:text-white" x-text="shippingCost > 0 ? '$' + shippingCost.toFixed(2) : 'FREE'"></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600 dark:text-gray-400">Estimated Tax</span>
                            <span class="text-fashion-black dark:text-white" x-text="'$' + taxAmount.toFixed(2)"></span>
                        </div>
                    </div>

                    <div class="p-6 border-t border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-fashion-charcoal">
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-display font-bold text-fashion-black dark:text-white">Total</span>
                            <span class="text-2xl font-display font-bold text-fashion-black dark:text-white" x-text="'$' + orderTotal.toFixed(2)"></span>
                        </div>
                    </div>

                    <!-- Trust Badges -->
                    <div class="p-6 border-t border-gray-200 dark:border-gray-800">
                        <div class="flex items-center justify-center gap-4 text-gray-400 dark:text-gray-500">
                            <div class="flex items-center gap-1.5">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <span class="text-xs">SSL Secure</span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                </svg>
                                <span class="text-xs">Easy Returns</span>
                            </div>
                            <div class="flex items-center gap-1.5">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
                                </svg>
                                <span class="text-xs">Fast Shipping</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
function checkoutPage() {
    return {
        step: 0,
        processing: false,
        cart: JSON.parse(localStorage.getItem('cart') || '{"items":[],"subtotal":0}'),

        info: { email: '', firstName: '', lastName: '', phone: '' },
        shipping: { address1: '', address2: '', city: '', state: '', postalCode: '', country: 'US' },
        selectedShipping: 'standard',
        saveAddress: false,
        paymentMethod: 'card',
        card: { number: '', name: '', expiry: '', cvv: '' },
        sameAsShipping: true,
        acceptTerms: false,

        promoCode: '',
        promoApplied: false,
        promoMessage: '',
        promoDiscount: 0,

        shippingMethods: {
            standard: { name: 'Standard Shipping', estimate: '5-7 business days', cost: 5.99, freeOver: 50 },
            express: { name: 'Express Shipping', estimate: '2-3 business days', cost: 12.99 },
            overnight: { name: 'Overnight Shipping', estimate: 'Next business day', cost: 24.99 }
        },

        get shippingCost() {
            const method = this.shippingMethods[this.selectedShipping];
            if (method && method.freeOver && this.cart.subtotal >= method.freeOver) {
                return 0;
            }
            return method ? method.cost : 5.99;
        },

        get taxAmount() {
            return (this.cart.subtotal - this.promoDiscount) * 0.08;
        },

        get orderTotal() {
            return this.cart.subtotal - this.promoDiscount + this.shippingCost + this.taxAmount;
        },

        getShippingName() {
            return this.shippingMethods[this.selectedShipping]?.name || 'Standard Shipping';
        },

        getShippingEstimate() {
            return this.shippingMethods[this.selectedShipping]?.estimate || '5-7 business days';
        },

        formatCardNumber(e) {
            let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            this.card.number = formattedValue;
        },

        formatExpiry(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4);
            }
            this.card.expiry = value;
        },

        applyPromo() {
            const code = this.promoCode.toUpperCase();
            if (code === 'SAVE10') {
                this.promoDiscount = this.cart.subtotal * 0.10;
                this.promoApplied = true;
                this.promoMessage = '10% discount applied!';
            } else if (code === 'SAVE20') {
                this.promoDiscount = this.cart.subtotal * 0.20;
                this.promoApplied = true;
                this.promoMessage = '20% discount applied!';
            } else if (code === 'FREESHIP') {
                this.promoApplied = true;
                this.promoMessage = 'Free shipping applied!';
            } else {
                this.promoApplied = false;
                this.promoMessage = '';
                alert('Invalid promo code');
            }
        },

        nextStep() {
            if (this.step === 0 && !this.validateInfo()) return;
            if (this.step === 2 && this.paymentMethod === 'card' && !this.validateCard()) return;
            if (this.step < 3) this.step++;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        },

        prevStep() {
            if (this.step > 0) this.step--;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        },

        validateInfo() {
            if (!this.info.email || !this.info.firstName || !this.info.lastName) {
                alert('Please fill in all contact information fields');
                return false;
            }
            if (!this.shipping.address1 || !this.shipping.city || !this.shipping.state || !this.shipping.postalCode) {
                alert('Please fill in all shipping address fields');
                return false;
            }
            return true;
        },

        validateCard() {
            if (!this.card.number || this.card.number.replace(/\s/g, '').length < 16) {
                alert('Please enter a valid card number');
                return false;
            }
            if (!this.card.name) {
                alert('Please enter the name on the card');
                return false;
            }
            if (!this.card.expiry || this.card.expiry.length < 5) {
                alert('Please enter a valid expiry date');
                return false;
            }
            if (!this.card.cvv || this.card.cvv.length < 3) {
                alert('Please enter a valid CVV');
                return false;
            }
            return true;
        },

        async placeOrder() {
            if (!this.acceptTerms) {
                alert('Please accept the terms and conditions');
                return;
            }

            this.processing = true;

            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 2500));

            // Generate order number
            const orderNumber = 'ALG-' + Date.now().toString(36).toUpperCase();

            // Clear cart
            localStorage.removeItem('cart');

            // Redirect to confirmation
            window.location.href = `/order-confirmation/${orderNumber}`;
        }
    };
}
</script>
}
