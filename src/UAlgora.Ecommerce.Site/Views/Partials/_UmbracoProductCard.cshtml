@using Umbraco.Cms.Core.Models.PublishedContent
@model IPublishedContent
@{
    var productName = Model.Value<string>("productName") ?? Model.Name;
    var sku = Model.Value<string>("sku") ?? "";
    var shortDescription = Model.Value<string>("shortDescription") ?? "";
    var basePrice = Model.Value<decimal>("basePrice");
    var salePrice = Model.Value<decimal?>("salePrice");
    var currencyCode = Model.Value<string>("currencyCode") ?? "USD";
    var isFeatured = Model.Value<bool>("isFeatured");
    var isOnSale = salePrice.HasValue && salePrice.Value > 0 && salePrice.Value < basePrice;
    var displayPrice = isOnSale ? salePrice.Value : basePrice;
    var stockQuantity = Model.Value<int>("stockQuantity");
    var isOutOfStock = stockQuantity <= 0;
    var productImage = Model.Value<IPublishedContent>("primaryImage");
    var brand = Model.Value<string>("brand") ?? "";

    // Currency formatting
    var currencySymbol = currencyCode switch
    {
        "USD" => "$",
        "EUR" => "€",
        "GBP" => "£",
        "INR" => "₹",
        _ => currencyCode + " "
    };
}

<div class="group bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden flex flex-col">
    <!-- Product Image -->
    <a href="@Model.Url()" class="relative aspect-square overflow-hidden bg-gray-100">
        @if (productImage != null)
        {
            <img src="@productImage.Url()" alt="@productName"
                 class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
        }
        else
        {
            <div class="w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                <svg class="w-16 h-16 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
            </div>
        }

        <!-- Badges -->
        <div class="absolute top-3 left-3 flex flex-col gap-2">
            @if (isFeatured)
            {
                <span class="bg-primary-600 text-white text-xs font-semibold px-2 py-1 rounded">Featured</span>
            }
            @if (isOnSale)
            {
                <span class="bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded">Sale</span>
            }
            @if (isOutOfStock)
            {
                <span class="bg-gray-600 text-white text-xs font-semibold px-2 py-1 rounded">Out of Stock</span>
            }
        </div>

        <!-- Quick Actions -->
        <div class="absolute top-3 right-3 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            <button type="button" class="w-9 h-9 bg-white rounded-full shadow flex items-center justify-center hover:bg-primary-50 transition"
                    title="Add to Wishlist">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
            </button>
            <button type="button" class="w-9 h-9 bg-white rounded-full shadow flex items-center justify-center hover:bg-primary-50 transition"
                    title="Quick View">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
            </button>
        </div>
    </a>

    <!-- Product Info -->
    <div class="p-4 flex flex-col flex-grow">
        @if (!string.IsNullOrEmpty(brand))
        {
            <span class="text-xs text-gray-500 uppercase tracking-wide mb-1">@brand</span>
        }

        <a href="@Model.Url()" class="text-gray-900 font-medium hover:text-primary-600 transition line-clamp-2 mb-2">
            @productName
        </a>

        @if (!string.IsNullOrEmpty(shortDescription))
        {
            <p class="text-sm text-gray-500 line-clamp-2 mb-3">@shortDescription</p>
        }

        <div class="mt-auto">
            <!-- Price -->
            <div class="flex items-center gap-2 mb-3">
                <span class="text-lg font-bold text-gray-900">@currencySymbol@displayPrice.ToString("N2")</span>
                @if (isOnSale)
                {
                    <span class="text-sm text-gray-400 line-through">@currencySymbol@basePrice.ToString("N2")</span>
                }
            </div>

            <!-- Add to Cart Button -->
            @if (!isOutOfStock)
            {
                <button type="button"
                        class="w-full bg-primary-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-primary-700 transition flex items-center justify-center gap-2"
                        data-product-id="@Model.Id"
                        data-product-sku="@sku"
                        data-product-name="@productName"
                        data-product-price="@displayPrice"
                        onclick="addToCart(this)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    Add to Cart
                </button>
            }
            else
            {
                <button type="button" disabled
                        class="w-full bg-gray-300 text-gray-500 py-2 px-4 rounded-lg font-medium cursor-not-allowed">
                    Out of Stock
                </button>
            }
        </div>
    </div>
</div>
